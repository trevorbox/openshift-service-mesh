apiVersion: security.istio.io/v1beta1
kind: PeerAuthentication
metadata:
  name: peerauthentication-spring-boot-demo-disable-mtls-cryostat-agent
  namespace: spring-boot-demo
spec:
  mtls:
    mode: STRICT
  # I suspect this is needed because agent to cryostat communication is specific pod IPs instead of service VIPs
  # https://github.com/istio/istio/issues/51658#issuecomment-2187075002
  portLevelMtls:
    '9977':
      mode: DISABLE
  selector:
    matchLabels:
      app.kubernetes.io/name: spring-boot-demo
